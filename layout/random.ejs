<section class="pjax-area">
    <%- include('_partial/single-photo.ejs') %>
    <script>
        var imageBox = document.getElementById("imgbox"); // imageBox 是放置大图片的图框
        var descBox = $("#descbox");
        var nextBox = $("#nextbox");
        var copyBox = $("#copybox");
        var wrapper = $("#exif-wrapper");
        var exifParam = $("#exif-param");
        var exifMaker = $("#exif-maker");
        var exifDate = $("#exif-date");
        var exifLens = $("#exif-lens");
        var exifLogo = $("#exif-maker-logo");
        var normalWrapper = $("#normal-wrapper");
        var normalData = $("#no-exif-data");
        const all = JSON.parse(`<%- JSON.stringify(site.data.photos) %>`);
        const keys = Object.keys(all);
        const max = keys.length;
        var value = null;
        function nextImage() {
            var random = Math.floor(Math.random() * max);
            var key = keys[random];
            var v = all[key];
            value = v;
            if (v === null) {
                return;
            }
            var imgLink = '<%- config.base_url %>' + '/' + v.path;
            imageBox.src = imgLink;
            var imageFancy = imageBox.parentElement;
            imageFancy.setAttribute("href", imgLink);
            var fancyBoxImage = document.getElementsByClassName("fancybox__image")[0];
            if (fancyBoxImage !== undefined) {
                fancyBoxImage.src = imgLink;
            }
            if (v.exif === "" || v.exif_data.length === 0) {
                wrapper.hide();
                normalWrapper.show();
                normalData.text("Shot By " + "<%- config.author %>");
                return;
            } else {
                wrapper.show();
                normalWrapper.hide();
            }
            const maker = v.exif_data['Image Make'];
            switch (maker) {
                case 'Apple': {
                    exifLogo.attr('src', 'img/apple.png');
                    break;
                }
                default:
                case 'FUJIFILM': {
                    exifLogo.attr('src', 'img/fujifilm.png');
                    break;
                }
            }
            exifLens.text(v.exif_data['EXIF LensModel']);
            exifMaker.text(v.exif_data['Image Make'] + ' ' + v.exif_data['Image Model'])
            exifDate.text(v.exif_data['EXIF DateTimeOriginal']);
            exifParam.text(v.exif_data['EXIF ISOSpeedRatings'] + ' ' + v.exif_data['EXIF FNumber'] + ' ' + v.exif_data['EXIF ExposureTime']);
        }
        function copyLink() {
            if (value !== null) {
                copyToClipboard('<%- config.url %>/photo?name=' + value.path);
            }
        }
        nextBox.click(nextImage);
        copyBox.click(copyLink);
        nextImage();
    </script>
</section>